<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
  <title>BIFAN2025 SEAT FINDER</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family:'Noto Sans KR',sans-serif;
      background: url('https://www.bifan.kr/presskit/2025/09/images/press_09_01.jpg') no-repeat center center fixed;
      background-size: cover;
      margin:0; padding:0;
      display:flex; flex-direction:column; align-items:center;
      color:#fff;
    }
    .overlay {
      background:rgba(0,0,0,0.7);
      backdrop-filter:blur(10px);
      width:90%; max-width:700px;
      padding:40px 25px;
      border-radius:20px;
      box-shadow:0 8px 32px rgba(0,0,0,0.3);
      text-align:center;
      margin:30px 0;
    }
    .logo { max-width:180px; margin-bottom:20px; }
    h1 { font-size:2.2em; margin-bottom:10px; }
    h1 span { display:block; }
    .warning { font-weight:bold; font-size:0.8em; color:tomato; margin:4px 0; }
    input[type="text"] {
      width:calc(100% - 36px);
      padding:14px 18px;
      font-size:1em;
      border:none;
      border-radius:10px;
      box-shadow:0 2px 6px rgba(0,0,0,0.2);
      margin:20px 0 15px;
      box-sizing:border-box;
    }
    button {
      padding:12px 26px;
      background-color:#436aec;
      border:none;
      border-radius:10px;
      color:#fff;
      font-size:1em;
      cursor:pointer;
      transition:0.3s;
      box-shadow:0 4px 10px rgba(0,0,0,0.2);
      margin-right:10px;
    }
    button:hover { background-color:#2e4cbf; }
    .refresh-btn { background-color:#888; }
    .refresh-btn:hover { background-color:#666; }

    .result {
      width:90%; max-width:700px;
      text-align:left;
      margin-bottom:20px;
      color:#000;
    }
    .result .card {
      padding:16px;
      margin-bottom:12px;
      background:#eef5ff;
      border-radius:8px;
      cursor:pointer;
      transition:0.2s;
      color:#000;
    }
    .card:hover { background:#d0e4ff; }
    .card .name { font-weight:700; font-size:1.1em; }
    .card .info { margin-top:4px; font-size:0.95em; }
    .card .seat { margin-top:4px; font-size:0.95em; font-weight:bold; }
    .card .meta { margin-top:4px; font-size:0.85em; }

    .seat-map-wrapper { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 10px; box-sizing: border-box; display:none; margin-bottom:30px; background:#fff; border-radius:12px; }
    .seat-map { display: grid; grid-template-columns: repeat(38, minmax(40px, 1fr)); gap: 4px; }
    .seat-cell { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.75em; box-sizing: border-box; }
    .seat-cell.yellow { background-color: #FFD700; }
    .seat-cell.lightblue { background-color: #00B0F0; }
    .seat-cell.navy { background-color: #002060; }
    .seat-cell.empty { background: transparent; }
    .seat-cell.highlight { outline: 2px solid red; }
  </style>
</head>
<body>
  <div class="overlay">
    <img src="https://www.bifan.kr/web/images/main/main2025_header_logo_w.png" class="logo" alt="BIFAN Logo">
    <h1><span>BIFAN2025</span><span>SEAT FINDER</span></h1>
    <h3 class="warning">* 스태프 사용 용도이므로 외부 공유 금지 바랍니다.</h3>
    <h3 class="warning">* 성함 또는 소속 일부 글자만 입력해도 검색 가능합니다.</h3>
    <h3 class="warning">* 동명이인일 경우 게이트 또는 소속과 직함으로 확인해 주세요.</h3>
    <h3 class="warning">* 검색 결과를 터치하면 좌석 위치를 보실 수 있습니다.</h3>
    <h3 class="warning">* 새로 검색하실 경우 새로고침을 눌러주세요.</h3>
    <h3 class="warning">* 문제가 있을 경우 010-9936-4276으로 전화 주세요.</h3>
    <input type="text" id="nameInput" placeholder="성함 또는 소속을 입력해 주세요">
    <button id="searchBtn">조회</button>
    <button id="refreshBtn" class="refresh-btn">새로고침</button>
  </div>

  <div class="result" id="result"></div>

  <div id="map-1F" class="seat-map-wrapper" data-cols="38">
    <div class="seat-map">
      <!-- 붙여넣으신 좌석도 전체 내용 -->
    </div>
  </div>

  <script>
    document.getElementById('refreshBtn').addEventListener('click', () => location.reload());

    window.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.seat-map-wrapper').forEach(wrapper => {
        const cols = parseInt(wrapper.dataset.cols, 10);
        const grid = wrapper.querySelector('.seat-map');
        if (cols && grid) grid.style.gridTemplateColumns = `repeat(${cols}, minmax(40px,1fr))`;
        wrapper.querySelectorAll('.seat-cell').forEach(cell => {
          const txt = cell.textContent.trim();
          if (txt) cell.id = `map-1F-${txt}`;
        });
      });
    });

    const sheetUrl = 'https://docs.google.com/spreadsheets/d/1vJDO2ED45nZtkxJC9ii_hLPHYJhn2IoBQXGDoiKHZA4/gviz/tq?tqx=out:json&sheet=폐막식';

    async function lookupSeat() {
      const kw = document.getElementById('nameInput').value.trim().toLowerCase();
      const rEl = document.getElementById('result');
      rEl.innerHTML = '';
      if (!kw) return rEl.textContent = '이름 또는 소속을 입력해 주세요.';
      rEl.textContent = '조회 중…';
      try {
        const res = await fetch(sheetUrl, { cache: 'no-store' });
        const txt = await res.text();
        const json = JSON.parse(txt.substring(47).slice(0,-2));
        const cards = [];
        json.table.rows.forEach(r => {
          const name   = r.c[20]?.v || '';
          const aff    = r.c[21]?.v || '';
          const title  = r.c[22]?.v || '직함없음';
          const seatNo = r.c[28]?.v || '';
          const team   = r.c[16]?.v || '';
          const inv    = r.c[17]?.v || '';
          if ([name,aff].some(v => v.toLowerCase().includes(kw))) {
            cards.push(`
              <div class="card" data-seat="${seatNo}">
                <div class="name">${name} 님</div>
                <div class="info">소속: ${aff}</div>
                <div class="info">직함: ${title}</div>
                <div class="seat">좌석: ${seatNo}</div>
                <div class="meta">초청 담당: ${team}/${inv}</div>
              </div>
            `);
          }
        });
        if (!cards.length) {
          rEl.textContent = '등록된 정보가 없습니다.';
          return;
        }
        rEl.innerHTML = cards.join('');
        rEl.querySelectorAll('.card').forEach(card => {
          card.addEventListener('click', () => {
            document.querySelectorAll('.seat-map-wrapper').forEach(w => w.style.display = 'none');
            const map = document.getElementById('map-1F');
            map.style.display = 'block';
            document.querySelectorAll('.seat-cell.highlight').forEach(h => h.classList.remove('highlight'));
            const target = document.getElementById(`map-1F-${card.dataset.seat}`);
            if (target) target.classList.add('highlight');
          });
        });
      } catch (e) {
        console.error(e);
        rEl.textContent = '조회 중 오류가 발생했습니다.';
      }
    }

    document.getElementById('searchBtn').addEventListener('click', lookupSeat);
    document.getElementById('nameInput').addEventListener('keypress', e => { if (e.key === 'Enter') lookupSeat(); });
  </script>
</body>
</html>
